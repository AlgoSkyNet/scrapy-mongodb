<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>scrapy-mongodb by sebdah</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>scrapy-mongodb</h1>
        <p>MongoDB pipeline for Scrapy. This module supports both MongoDB in standalone setups and replica sets. This module will insert the items to MongoDB as soon as your spider finds data to extract.</p>

        <p class="view"><a href="https://github.com/sebdah/scrapy-mongodb">View the Project on GitHub <small>sebdah/scrapy-mongodb</small></a></p>


        <ul>
          <li><a href="https://github.com/sebdah/scrapy-mongodb/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/sebdah/scrapy-mongodb/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/sebdah/scrapy-mongodb">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><a href="https://travis-ci.org/sebdah/scrapy-mongodb"><img src="https://secure.travis-ci.org/sebdah/scrapy-mongodb.png?branch=master"></a></p>

<h1>
<a name="scrapy-mongodb" class="anchor" href="#scrapy-mongodb"><span class="octicon octicon-link"></span></a>scrapy-mongodb</h1>

<p>MongoDB pipeline for Scrapy. This module supports both MongoDB in standalone setups and replica sets. This module will insert the items to MongoDB as soon as your spider finds data to extract.</p>

<p><code>scrapy-mongodb</code> can also buffer objects if you prefer to write chunks of data to MongoDB rather than one write per document. See the <code>MONGODB_BUFFER_DATA</code> option for details.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Install via <code>pip</code>:</p>

<pre><code>pip install scrapy-mongodb
</code></pre>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<h3>
<a name="basic-configuration-example" class="anchor" href="#basic-configuration-example"><span class="octicon octicon-link"></span></a>Basic configuration example</h3>

<p>Add <code>scrapy-mongodb</code> to your projects <code>settings.py</code> file.</p>

<pre><code>ITEM_PIPELINES = [
  'scrapy_mongodb.MongoDBPipeline',
]

MONGODB_URI = 'mongodb://localhost:27017'
MONGODB_DATABASE = 'scrapy'
MONGODB_COLLECTION = 'my_items'
</code></pre>

<p>If you want a unique key in your database, add the key to the configuration like this:</p>

<pre><code>MONGODB_UNIQUE_KEY = 'url'
</code></pre>

<h3>
<a name="configure-mongodb-replica-sets" class="anchor" href="#configure-mongodb-replica-sets"><span class="octicon octicon-link"></span></a>Configure MongoDB replica sets</h3>

<p>You can configure <code>scrapy-mongodb</code> to support MongoDB replica sets simply by adding the <code>MONGODB_REPLICA_SET</code> and <code>MONGODB_REPLICA_SET_HOSTS</code> config option:</p>

<pre><code>MONGODB_REPLICA_SET = 'myReplicaSetName'
MONGODB_URI = 'mongodb://host1.example.com:27017,host2.example.com:27017,host3.example.com:27017'
</code></pre>

<p>If you need to ensure that your data has been replicated, use the <code>MONGODB_REPLICA_SET_W</code> option. It is an implementation of the <code>w</code> parameter in <code>pymongo</code>. Details from the <code>pymongo</code> documentation:</p>

<pre><code>Write operations will block until they have been replicated to the specified number or tagged set of servers. w=&lt;int&gt; always includes the replica set primary (e.g. w=3 means write to the primary and wait until replicated to two secondaries). Passing w=0 disables write acknowledgement and all other write concern options.
</code></pre>

<h3>
<a name="configure-data-buffering" class="anchor" href="#configure-data-buffering"><span class="octicon octicon-link"></span></a>Configure data buffering</h3>

<p>To ease the load on MongoDB <code>scrapy-mongodb</code> has a buffering feature. You can enable it by simply setting the <code>MONGODB_BUFFER_DATA</code> to the buffer size you want. If you set it to <code>10</code> <code>scrapy-mongodb</code> will write 10 documents at a time to MongoDB.</p>

<pre><code>MONGODB_BUFFER_DATA = 10
</code></pre>

<p>It is not possible to combine this feature with <code>MONGODB_UNIQUE_KEY</code>. Technically due to that the <code>update</code> method in <code>pymongo</code> doesn't support multi doc updates.</p>

<h3>
<a name="adding-timestamps" class="anchor" href="#adding-timestamps"><span class="octicon octicon-link"></span></a>Adding timestamps</h3>

<p><code>scrapy-mongodb</code> can append a timestamp to your item when inserting it to the database. Enable this feature by like this:</p>

<pre><code>MONGODB_ADD_TIMESTAMP = True
</code></pre>

<p>This will modify the document to look something like this:</p>

<pre><code>{
    ...
    'scrapy-mongodb': {
        'ts': ISODate("2013-01-10T07:43:56.797Z")
    }
    ...
}
</code></pre>

<p>The timestamp is in UTC.</p>

<h2>
<a name="full-list-of-config-options" class="anchor" href="#full-list-of-config-options"><span class="octicon octicon-link"></span></a>Full list of config options</h2>

<p>Configuration options available. Put these in your <code>settings.py</code> file.</p>

<table border="1">
<tr>
<th>Parameter</th>
        <th>Default</th>
        <th>Required?</th>
        <th>Description</th>
    </tr>
<tr>
<td>MONGODB_DATABASE</td>
        <td>scrapy-mongodb</td>
        <td>No</td>
        <td>Database name to use. Does not need to exist.</td>
    </tr>
<tr>
<td>MONGODB_COLLECTION</td>
        <td>items</td>
        <td>No</td>
        <td>Collection within the database to use. Does not need to exist.</td>
    </tr>
<tr>
<td>MONGODB_URI</td>
        <td>mongodb://localhost:27017</td>
        <td>No</td>
        <td>
            Add the URI to the MongoDB instance or replica set you want to connect to. It must start with mongodb://. See more in the MongoDB docs 1). Some example strings:<br>
            mongodb://user:pass@host:port<br>
            mongodb://user:pass@host:port,host2:port2,
        </td>
    </tr>
<tr>
<td>MONGODB_UNIQUE_KEY</td>
        <td>None</td>
        <td>No</td>
        <td>
            If you want to have a unique key in the database, enter the key name here. scrapy-mongodb will ensure the key is properly indexed.
        </td>
    </tr>
<tr>
<td>MONGODB_BUFFER_DATA</td>
        <td>None</td>
        <td>No</td>
        <td>
            To ease the load on MongoDB you might want to buffer data in the client before sending it to MongoDB. Set this option to the number of items you want to buffer in the client before sending them to MongoDB. Setting a MONGODB_UNIQUE_KEY together with MONGODB_BUFFER_DATA is not supported.
        </td>
    </tr>
<tr>
<td>MONGODB_ADD_TIMESTAMP</td>
        <td>False</td>
        <td>No</td>
        <td>
            If this is set to True, scrapy-mongodb will add a timestamp key to the documents. The document will look like this:<br>
            { scrapy_mongo: { ts: ISODate("2013-01-10T07:43:56.797Z") } }
        </td>
    </tr>
<tr>
<td>MONGODB_FSYNC</td>
        <td>False</td>
        <td>No</td>
        <td>
            If this is set to True it forces MongoDB to wait for all files to be synced before returning.
        </td>
    </tr>
<tr>
<td>MONGODB_REPLICA_SET</td>
        <td>None</td>
        <td>Yes, for replica sets</td>
        <td>
            Set this if you want to enable replica set support. The option should be given the name of the replica set you want to connect to. MONGODB_HOST and MONGODB_PORT should point at your config server.
        </td>
    </tr>
<tr>
<td>MONGODB_REPLICA_SET_W</td>
        <td>0</td>
        <td>No</td>
        <td>
            Best described in the pymongo documentation 2):<br>
            Write operations will block until they have been replicated to the specified number or tagged set of servers. w= always includes the replica set primary (e.g. w=3 means write to the primary and wait until replicated to two secondaries). Passing w=0 disables write acknowledgement and all other write concern options.
        </td>
    </tr>
</table><ol>
<li><a href="http://docs.mongodb.org/manual/reference/connection-string/">http://docs.mongodb.org/manual/reference/connection-string/</a></li>
<li><a href="http://api.mongodb.org/python/current/api/pymongo/mongo_replica_set_client.html#pymongo.mongo_replica_set_client.MongoReplicaSetClient">http://api.mongodb.org/python/current/api/pymongo/mongo_replica_set_client.html#pymongo.mongo_replica_set_client.MongoReplicaSetClient</a></li>
</ol><h3>
<a name="deprecated-config-options" class="anchor" href="#deprecated-config-options"><span class="octicon octicon-link"></span></a>Deprecated config options</h3>

<table border="1">
<tr>
<td>MONGODB_HOST</td>
        <td>localhost</td>
        <td>No</td>
        <td>
            DEPRECATED since scrapy-mongodb 0.5.0, use MONGODB_URI instead.<br>
            MongoDB host name to connect to.
        </td>
    </tr>
<tr>
<td>MONGODB_PORT</td>
        <td>27017</td>
        <td>No</td>
        <td>
            DEPRECATED since scrapy-mongodb 0.5.0, use MONGODB_URI instead.<br>
            MongoDB port number to connect to.
        </td>
    </tr>
<tr>
<td>MONGODB_REPLICA_SET_HOSTS</td>
        <td>None</td>
        <td>No</td>
        <td>
            DEPRECATED since scrapy-mongodb 0.5.0, use MONGODB_URI instead.<br>
            Host string to use to connect to the replica set. See the hosts_or_uri option in the pymongo documentation.
        </td>
    </tr>
</table><h2>
<a name="release-information" class="anchor" href="#release-information"><span class="octicon octicon-link"></span></a>Release information</h2>

<p><strong>0.6.0 (2013-06-04)</strong></p>

<ul>
<li><a href="https://github.com/sebdah/scrapy-mongodb/issues/6">#6 ScrapyDeprecationWarning: crawler.settings</a></li>
<li><a href="https://github.com/sebdah/scrapy-mongodb/issues/7">#7 Use Python format() for output</a></li>
<li><a href="https://github.com/sebdah/scrapy-mongodb/issues/8">#8 Bug when upserting items with a unique key</a></li>
</ul><p><strong>0.5.1 (2013-06-03)</strong></p>

<ul>
<li>Updated docstrings</li>
</ul><p><strong>0.5.0 (2013-01-10)</strong></p>

<ul>
<li>Implemented feature <a href="https://github.com/sebdah/scrapy-mongodb/issues/5">#5 Add flag for setting timestamps in the database</a>
</li>
<li>Implemented feature <a href="https://github.com/sebdah/scrapy-mongodb/issues/4">#4 Implement support for MongoDB authentication</a>
</li>
<li>Implemented feature <a href="https://github.com/sebdah/scrapy-mongodb/issues/3">#3 Add support for MongoDB URIs when connecting</a>
</li>
<li>Implemented feature <a href="https://github.com/sebdah/scrapy-mongodb/issues/2">#2 Support buffered data</a>
</li>
</ul><p><strong>0.4.0 (2013-01-07)</strong></p>

<ul>
<li>Added support for MongoDB replica set host strings</li>
</ul><p><strong>0.3.0 (2013-01-06)</strong></p>

<ul>
<li>Minor supportive updates</li>
</ul><p><strong>0.2.0 (2013-01-06)</strong></p>

<ul>
<li>Fixed connection problem for MongoDB replica sets</li>
<li>Fixed bad default parameter handling</li>
</ul><p><strong>0.1.0 (2013-01-06)</strong></p>

<ul>
<li>Initial release of the <code>scrapy-mongodb</code> pipeline module</li>
<li>Support for MongoDB replica sets and standalone databases</li>
</ul><h2>
<a name="instructions-to-release-project-to-pypi" class="anchor" href="#instructions-to-release-project-to-pypi"><span class="octicon octicon-link"></span></a>Instructions to release project to PyPi</h2>

<pre><code>make release
</code></pre>

<h2>
<a name="author" class="anchor" href="#author"><span class="octicon octicon-link"></span></a>Author</h2>

<p>This project is maintained by <a href="http://www.sebastiandahlgren.se">Sebastian Dahlgren</a> (<a href="https://github.com/sebdah">GitHub</a> | <a href="https://twitter.com/sebdah">Twitter</a> | <a href="http://www.linkedin.com/in/sebastiandahlgren">LinkedIn</a>)</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>APACHE LICENSE 2.0
Copyright 2013 Sebastian Dahlgren</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>


      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/sebdah">sebdah</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-37516009-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>